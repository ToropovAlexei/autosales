services:
  redis:
    image: redis:8-alpine
    container_name: autosales_bot_redis
    ports:
      - "${REDIS_PORT}:6379"
    restart: unless-stopped

  bot:
    build:
      context: .
      dockerfile: tgbot_rust/Dockerfile
    container_name: autosales_bot
    environment:
      TELEGRAM_API_ID: ${TELEGRAM_API_ID}
      TELEGRAM_API_HASH: ${TELEGRAM_API_HASH}
      REDIS_HOST: ${REDIS_HOST:-redis}
      REDIS_PORT: ${REDIS_PORT}
      BACKEND_API_URL: ${BACKEND_API_URL}
      WEBHOOK_HOST: ${WEBHOOK_HOST}
      WEBHOOK_PORT: ${WEBHOOK_PORT}
      SERVICE_API_KEY: ${SERVICE_API_KEY}
      MANAGER_BOT_TOKEN: ${MANAGER_BOT_TOKEN}
      PAYMENT_INSTRUCTIONS_URL: ${PAYMENT_INSTRUCTIONS_URL}
    ports:
      - "${WEBHOOK_PORT}:${WEBHOOK_PORT}"
    depends_on:
      - redis
    restart: unless-stopped
