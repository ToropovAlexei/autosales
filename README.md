# Платформа для E-commerce с Telegram-ботом

Это комплексное приложение, представляющее собой платформу для электронной коммерции. Она включает в себя бэкенд на FastAPI, фронтенд для администрирования на Next.js и Telegram-бота на aiogram для взаимодействия с клиентами.

## Возможности

-   **Административная панель:** Удобный веб-интерфейс для продавцов для управления категориями, товарами, складом, заказами и транзакциями.
-   **Telegram-бот для клиентов:** Позволяет пользователям просматривать каталог товаров, пополнять баланс и совершать покупки прямо в Telegram.
-   **Реферальная программа:** Продавцы могут включить реферальную программу, позволяя пользователям создавать собственные "магазины-боты" и получать процент с продаж.
-   **Система высокой доступности:** Основной Telegram-бот находится под управлением монитора, который отслеживает его состояние. В случае сбоя, монитор автоматически запускает резервного бота и может создать нового при необходимости, обеспечивая бесперебойную работу.

## Предварительные требования

Перед началом убедитесь, что у вас установлено следующее:
- Python 3.8+
- Node.js 18.x+
- pnpm (или npm/yarn)
- Docker и Docker Compose

## Базы данных

Для локальной разработки используются PostgreSQL и Redis, которые можно запустить с помощью Docker Compose.

1.  **Запустите контейнеры:**
    В корневой папке проекта выполните команду:
    ```bash
    docker-compose up -d
    ```
    Эта команда запустит PostgreSQL и Redis в фоновом режиме.

## Установка и запуск

Этот проект разделен на три основных компонента: `backend`, `frontend` и `tgbot`. Следуйте приведенным ниже инструкциям для настройки каждой части.

### Бэкенд

Бэкенд представляет собой приложение FastAPI, которое служит API для фронтенда и Telegram-бота.

1.  **Перейдите в каталог бэкенда:**
    ```bash
    cd backend
    ```

2.  **Создайте файл .env:**
    Создайте файл `.env` в каталоге `backend`, скопировав содержимое из `.env.example`, и заполните его необходимыми данными.

3.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    python -m venv .venv
    source .venv/bin/activate
    ```

4.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

5.  **Инициализируйте и заполните базу данных:**
    ```bash
    python init_db.py
    python seed_db.py # Опционально, для заполнения тестовыми данными
    ```

6.  **Запустите сервер бэкенда:**
    ```bash
    uvicorn main:app --reload
    ```
    Бэкенд будет запущен по адресу `http://127.0.0.1:8000`.

### Фронтенд

Фронтенд представляет собой приложение Next.js, которое предоставляет административную панель.

1.  **Перейдите в каталог фронтенда:**
    ```bash
    cd frontend
    ```

2.  **Установите зависимости:**
    ```bash
    pnpm install
    ```

3.  **Запустите сервер для разработки:**
    ```bash
    pnpm run dev
    ```
    Фронтенд будет запущен по адресу `http://localhost:3000`.

### Telegram-бот

Telegram-бот создан с использованием `aiogram` и обеспечивает взаимодействие с клиентами.

1.  **Перейдите в каталог tgbot:**
    ```bash
    cd tgbot
    ```

2.  **Создайте файл .env:**
    Создайте файл `.env` в каталоге `tgbot`, скопировав содержимое из `.env.example`, и заполните его необходимыми токенами и настройками.

3.  **Создайте файл tokens.txt:**
    Создайте файл `tokens.txt` и добавьте в него как минимум один токен вашего основного бота. Монитор будет использовать этот список для запуска и отслеживания ботов.

4.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    python -m venv .venv
    source .venv/bin/activate
    ```

5.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

6.  **Запустите монитор бота:**
    Для запуска бота и системы мониторинга выполните:
    ```bash
    python monitor.py
    ```
    Монитор запустит основного бота, назначит резервного и будет поддерживать их в рабочем состоянии. Убедитесь, что вы заполнили `API_ID` и `API_HASH` в файле `monitor.py` для возможности автоматического создания ботов.

## Конфигурация

- **Бэкенд:** `backend/config.py` и `.env` файл. Здесь настраиваются подключение к базе данных, секретные ключи и другие параметры API.
- **Фронтенд:** `frontend/src/constants/endpoints.ts` для URL-адресов API. Основные настройки Next.js находятся в `next.config.ts`.
- **Telegram-бот:** `tgbot/config.py` и `.env` файл для токенов и настроек API.
- **Монитор:** `tgbot/monitor.py` содержит конфигурацию для системы высокой доступности, включая `API_ID` и `API_HASH` для работы с BotFather.